# MySQLの安全なメジャーアップデートについて

## 手順

1. バックアップの取得：

    メジャーアップデート前に、元のRDSクラスターのバックアップを作成する

2. テスト環境の構築：

    アップデートのテスト環境用に、RDSクラスターを複製する。その際、以下のポイントに注意する。
    - 複製クラスターは元のクラスターと**同一リージョン**に作成する
    - メジャーアップデートの前に、RDSクラスターのエンジンバージョンを**アップデート対象のバージョン**に指定する

3. テスト環境内でのメジャーアップデートの実施：

    テスト環境内でメジャーアップデートを実施する。その際、以下のポイントに注意する。
    - アップデート開始時刻を記録しておき、アップデート完了までのタウンタイムを計測しておく
    - アップデート中にエラーが発生しないか確認しておく

4. セキュリティグループ（SG）の設定：

    複製したRDSクラスターのSGを設定し、必要なアクセス許可を付与する。

5. アプリケーションの設定：

    本番環境で実行されるアプリケーションをテスト環境内でも実行し、新しいRDSクラスターに接続できるように設定する。アプリケーションの設定ファイルや接続文字列を更新して、新しいDBエンドポイントを指定する。

6. テストおよび検証：

    テスト環境内のアプリケーションを使用して、実際のテスト・検証を行う。その際、以下のポイントに注意する。
    - アプリケーションが正常に動作することを確認する
    - クエリやDB操作がエラーを起こさないことを確認する
    - データが適切に同期されていることを確認する
    - パフォーマンス（クエリ応答時間、DB使用率など）を監視し、問題がないか確認する

7. テスト用クラスターの停止・削除：
必要なテストと検証が完了したら、アップデート適用前にテスト用クラスターを停止・削除する

8. 本番環境のバックアップの作成：

    アップデート後にロールバックできるよう、バックアップを取得しておく。どのタイミングまでを必要とするか検討する。

9. 本番環境のアップデートの実施：

    本番環境のRDSクラスターにメジャーアップデートを適用する。アップデートプロセス中は、パフォーマンスモニタリングを継続的に行い、問題が発生しないことを確認する。

10. アップデート実行対応のフィードバック：

    実際にアップデートを終えて、得られたことを文書化しチーム内で共有する。また、結果を踏まえて必要があれば、この手順自体も随時加筆修正する。